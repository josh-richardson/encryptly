<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script src="https://code.jquery.com/jquery-3.2.1.js"
            integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>

</head>
<body>

<h2>{{ user.username }}</h2>
<div id="friends" style="height:500px; width: 200px; background-color:aliceblue; ">

</div>
<div id="chat"
     style="width: 500px; height: 500px; overflow-y:scroll; background-color: aliceblue; transform: translate(250px, -500px); margin: 0 100px 0 auto; display:block; float: left">

</div>
<br/>
<input id="message" style="width: 442px" title="Your message:" placeholder="Your message"/>
<button type="button" id="submit">Send</button>


<br/>
<br/>
<input id="friendName" style="width: 442px" title="Your message:" placeholder="Add friend"/>
<button type="button" id="addFriend">Add</button>


<script type="text/javascript">
    var socket = null;

    socket = new WebSocket("ws://" + window.location.host + "/");
    var targetUser;
    socket.onopen = function () {
        socketSend({"intent": "get_friends"})
    };

    function socketSend(data) {
        if (socket.readyState == WebSocket.OPEN) {
            socket.send(JSON.stringify(data));
        }
    }

    $('#submit').click(function () {
        var messageElement = $('#message');
        socketSend({"intent": "send_message", "content": messageElement.val(), "username": targetUser});
        messageElement.val("");
    });

    $('#addFriend').click(function () {
        socketSend({"intent": "friend_request", "username": $('#friendName').val()});
    });


    socket.onmessage = function (e) {
        var data = JSON.parse(e.data);
        if (data['error'] != null) {
            alert("Request failed: " + data['error']);
            return;
        }
        if (data['intent'] == "get_friends") {
            data['friends'].forEach(function (element) {
                $('#friends').append("<a class='messageClick' href='#'>" + element + "</a>");
            });

            $('.messageClick').click(function () {
                alert("click event");
            });
        }
    };

</script>
</body>
</html>